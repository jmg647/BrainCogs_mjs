%For manual exclusion of sessions in which data were compromised by rig problems, etc.

function logs = excludeBadBlocks( logs, experiment )

switch experiment
    case 'mjs_memoryMaze_NAc_DREADD_performance'

        exclude = {...
            "mjs20_439",datetime('2021-04-23');...
            "mjs20_439",datetime('2021-05-04');
            "mjs20_665",datetime('2021-03-11')};

    case 'mjs_taskLearning_NAc_DREADD2'
        %**M11 & M12 were switched on 210702...
        exclude = {...
            "mjs20_11",datetime('2021-07-02'),[];...
            "mjs20_12",datetime('2021-07-02'),[];...
            "mjs20_13",datetime('2021-08-06'),[];... %Milk spout leaking...
            "mjs20_15",datetime('2021-08-11'),[];... %Milk spout leaking
            "mjs20_11",datetime('2021-08-18'),[];...
            "mjs20_12",datetime('2021-08-18'),[];...
            "mjs20_13",datetime('2021-08-18'),[];...
            "mjs20_14",datetime('2021-08-18'),[];...
            "mjs20_15",datetime('2021-08-18'),[];...
            "mjs20_16",datetime('2021-08-18'),[];...
            "mjs20_17",datetime('2021-08-18'),[];... %Bug with reward delivery (omitted after error)
            "mjs20_17",datetime('2021-08-26'),[]};   %Mounting apparatus failed (head plate rotated)
    case 'mjs_taskLearningWalls'
        exclude = {...
            "mjs20_09",datetime('13-Aug-2021'),[1,2];... %Manual tests
            "mjs20_09",datetime('17-Sep-2021'),2;... %Accidentally auto-advanced after the first (short) block
            "mjs20_09",datetime('28-Sep-2021'),'all';... %Reward spout moved out-of-reach
            "mjs20_10",datetime('01-Oct-2021'),[1,2];... %Projector accidentally blocked
            };
end

%Remove specified blocks prior to session data extraction
for i = 1:size(exclude,1)
    if ismember(logs.animal.name,exclude{i,1}) &&...
            string(datetime(logs.session.start,'Format','dd-MMM-yyyy'))==exclude{i,2} &&...
            strcmp(exclude{i,3},'all')
        logs = [];  %Exclude whole session
        return
    elseif ismember(logs.animal.name,exclude{i,1}) &&...
            string(datetime(logs.session.start,'Format','dd-MMM-yyyy'))==exclude{i,2}
        logs.block = logs.block(~ismember(1:numel(logs.block), exclude{i,3}));
        return
    end
end